<!DOCTYPE html>

<head>
  <script>
    them = window.location.search.replace("?them=", "");
  </script>


  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Handshake Reader</title>

  <script type="application/javascript" src="../jsHashes-master/hashes.js"></script>
  <script type="application/javascript"></script>

  <style type="text/css" media="screen">
    body {
      text-align: center;
    }
  </style>

</head>

<body>
  <em>
    Type your unique passphrase here. <br>
    It will be converted to a long unique ID and added to the ID of the person whose QR code you scanned.
    Then it will generate a URL to a pre-filled Google Form, which you will be redirected to when you click submit.
  </em>



  <form name="IDform" id="IDform" onsubmit="event.preventDefault();
      hashGenerated = new Hashes.SHA256().hex(document.getElementById('uniquePassphrase').value);
      urlGenerated = 'https\:\/\/docs.google.com/forms/d/e/1FAIpQLSeIDZrpksYUhL5DZ4T1mF-8lqj8a5tjO6SDk_MfzP4HIt3tDg/viewform?usp=pp_url&entry.895123374=Person_' + hashGenerated + '&entry.234110086=' + them;
      document.getElementById('hashed').innerText = 'Person_' + hashGenerated;
      document.getElementById('urlGenerated').innerHTML = '<a href=' + urlGenerated + '>' + urlGenerated + '</a>';
      document.getElementById('redirectNotice').innerText = 'Redirecting to Google Forms shortly...';
      window.location.href = urlGenerated;
      ">
    <input style="visibility: hidden; height: 0px; width: 0px" type="text" name="placeHolderSoThatBrowsersSavePassphrase" id="placeholder" rows="1" cols="1">
    Unique Passphrase: <br>
    <div style="font-size: small;"><em>(you make this up, then you should never change this. Please make sure it is something no-one else would choose so that you don't end up with the same ID as someone else.)</em> </div><br>
    <input type="password" id="uniquePassphrase" name="pwd">
    <br>
    <input type="submit" value="Submit">
  </form>
  <div id="redirectNotice"></div>

  <em>Your unique ID is:</em>
  <div id="hashed"></div>

  <em>Your generated URL is:</em>
  <br>
  <div style="font-size: small;"><em>(click it once you're done if the redirect does not work)</em></div>
  <div id="urlGenerated"></div>

  <br><br>
  <em>How does this work?</em> See: <a href="https://github.com/Coda-Coda/handshake">https://github.com/Coda-Coda/handshake</a>
  <br>
  <br>
  Please note that the current version of handshake <b>does not alert you</b> if a link between you and a case of Covid-19 is found - for now you would need to manually examine the publicly available data (see the links on <a href="https://github.com/Coda-Coda/handshake">https://github.com/Coda-Coda/handshake</a> - in particular the visualisation) looking for links between your hash/unique ID (see just above) and the hashes/unique IDs of others who have reported they are affected by Covid-19 on Handshake.

</body>